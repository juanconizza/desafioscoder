{{#if productFound}}
<section style="background-color: #eee;">
  <div class="container py-5 mb-5">
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6 col-xl-6">
        <div class="card" style="border-radius: 15px;">
          <div class="bg-image hover-overlay ripple ripple-surface ripple-surface-light text-center"
            data-mdb-ripple-color="light">
            <img src="{{productFound.photo}}"
              class="img-fluid"
              alt="{{productFound.tittle}}" />
            </div>
          <div class="card-body pb-0">
            <div class="d-flex justify-content-between">
              <div>
                <p class="text-dark">{{productFound.title}}</p>
                <p class="small text-muted">{{productFound.category}}</p>
              </div>
            </div>
          </div>
          <hr class="my-0" />
          <div class="card-body pb-0">
            <div class="d-flex justify-content-between">
              <p class="text-dark">Precio: ${{productFound.price}}</p>
              <p class="text-dark">Vendedor: {{seller.name}}</p>
            </div>
            <p class="small text-muted">STOCK: {{productFound.stock}}</p>
          </div>
          <hr class="my-0" />
          <div class="card-body pb-0">
                    <p class="text-dark">Descripción:</p>
              <p>{{productFound.description}}</p>
               </div>
          <hr class="my-0" />
          <div class="card-body">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <a href="/" class="btn btn-secondary">Atrás</a>

    {{#if isOnline}}
    <button id="addToCartBtn" type="button" class="btn btn-primary">Agregar al Carrito</button>
    {{else}}
    <p class="text-danger mb-0">Debes iniciar sesión para agregar este producto al carrito.</p>
    {{/if}}
  </div>

  {{#if isOnline}}
  <div class="text-center">
    <p id="addToCartMessage" class="text-success fw-bold" style="display: none;">¡Producto agregado al carrito!</p>
    <p id="failAddToCartMessage" class="text-danger fw-bold" style="display: none;">No puedes agregar tu propio producto al carrito.</p>
  </div>
  {{/if}}
</div>
        </div>
      </div>
    </div>
  </div>
  {{else}}
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-6">
      <div class="alert alert-danger" role="alert">
        El producto no existe o no se encontró la información.
      </div>
    </div>
  </div>
</div>
{{/if}}
</section>

<script>
  document.addEventListener("DOMContentLoaded", function() {
  const addToCartBtn = document.getElementById("addToCartBtn");
  const addToCartMessage = document.getElementById("addToCartMessage");
  const failAddToCartMessage = document.getElementById("failAddToCartMessage");

  if (addToCartBtn) {
    addToCartBtn.addEventListener("click", async () => {
      const product_id = "{{productFound._id}}";
      const buyer_id = "{{user_id}}";
      const seller_id = "{{productFound.seller_id}}";
      const quantity = 1;        
      const response = await fetch("/api/cart-contact", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          product_id,
          buyer_id,
          seller_id,
          quantity
        })
      });
      const responseData = await response.json();
      console.log(responseData);

      if (response.ok) {
        // El producto se agregó al carrito exitosamente
        addToCartMessage.style.display = "block";
        failAddToCartMessage.style.display = "none";
      } else if (response.status === 400) {
        // Mostrar mensaje de error si la respuesta es 400
        failAddToCartMessage.style.display = "block";
        addToCartMessage.style.display = "none";
      } else {
        // Manejar otros errores
        failAddToCartMessage.style.display = "none";
        addToCartMessage.style.display = "none";
      }
    });
  }
});
</script>

